
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Reconstruction Options &#8212; pysofi 0.1.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/classic.css" />
    
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Noise Filtration" href="filter.html" />
    <link rel="prev" title="Fourier Interpolation Module" href="finterp.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="filter.html" title="Noise Filtration"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="finterp.html" title="Fourier Interpolation Module"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">pysofi 0.1.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="manual.html" accesskey="U">PySOFI Reference Manual</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Reconstruction Options</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="reconstruction-options">
<h1>Reconstruction Options<a class="headerlink" href="#reconstruction-options" title="Permalink to this headline">¶</a></h1>
<p>This module provides multiple image processing and reconstruction options. For instance,
calculate the average image, calculate one moment-reconstructed image of a defined order,
calculate all moment-reconstructed or cumulant reconstructed images to the user-defined
highest order, calculate average moment or cumulant reconstructions over multiple user-
defind blocks, with or without Fourier interpolation or bleaching correction.</p>
<section id="module-pysofi.reconstruction">
<span id="functions"></span><h2>Functions<a class="headerlink" href="#module-pysofi.reconstruction" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="pysofi.reconstruction.average_image">
<span class="sig-prename descclassname"><span class="pre">pysofi.reconstruction.</span></span><span class="sig-name descname"><span class="pre">average_image</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filepath</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">frames</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.reconstruction.average_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the average image for a video file (tiff stack), either for the
whole video or for user defined frames.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filepath</strong> (<em>str</em>) – Path to the tiff file.</p></li>
<li><p><strong>filename</strong> (<em>str</em>) – Name of the tiff file.</p></li>
<li><p><strong>frames</strong> (<em>list of int</em><em>, </em><em>optional</em>) – Start and end frame number if not the whole video is used.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>mean_im</strong> – The average image.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pysofi.reconstruction.average_image_with_finterp">
<span class="sig-prename descclassname"><span class="pre">pysofi.reconstruction.</span></span><span class="sig-name descname"><span class="pre">average_image_with_finterp</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filepath</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">interp_num</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.reconstruction.average_image_with_finterp" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the average image with fourier interpolation for a video file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filepath</strong> (<em>str</em>) – Path to the tiff file.</p></li>
<li><p><strong>filename</strong> (<em>str</em>) – Name of the tiff file.</p></li>
<li><p><strong>interp_num</strong> (<em>int</em>) – Interpolation factor.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>mean_im</strong> (<em>ndarray</em>) – The average image after fourier interpolation. Interpolated</p></li>
<li><p><em>images can be further used for SOFI processing.</em></p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pysofi.reconstruction.block_ave_cumulants">
<span class="sig-prename descclassname"><span class="pre">pysofi.reconstruction.</span></span><span class="sig-name descname"><span class="pre">block_ave_cumulants</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filepath</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">highest_order</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">smooth_kernel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">251</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fbc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.04</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.reconstruction.block_ave_cumulants" title="Permalink to this definition">¶</a></dt>
<dd><p>Get average cumulant-reconstructed images of all blocks determined by
user-defined noise filtering and bleaching correction factor (fbc).</p>
<p>Within each block, the amount of signal decrease is identical. This
amount of signal decrease is characterized by the bleaching correction
factor, fbc, which is the fractional signal decrease within each block
(as compared to the total signal decrease over the whole signal plot).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filepath</strong> (<em>str</em>) – Path to the tiff file.</p></li>
<li><p><strong>filename</strong> (<em>str</em>) – Name of the tiff file.</p></li>
<li><p><strong>highest_order</strong> (<em>int</em>) – The highest order number of moment-reconstructed images.</p></li>
<li><p><strong>smooth_kernel</strong> (<em>int</em>) – The size of the median filter (‘filtering.med_smooth’) window.</p></li>
<li><p><strong>fbc</strong> (<em>float</em>) – The fraction of signal decrease within each block compared to the
total signal decrease.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>ave_k_set</strong> – order number (int) -&gt; image (ndarray)
A dictionary of avereage cumulant-reconstructed images of all blocks.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>For more information on noise filtering and bleaching corrextion, please
see appendix 3 of [1].</p>
<p class="rubric">References</p>
<dl class="footnote brackets">
<dt class="label" id="id1"><span class="brackets">1</span></dt>
<dd><ol class="upperalpha simple" start="24">
<li><p>Yi, and S. Weiss. “Cusp-artifacts in high order superresolution</p></li>
</ol>
</dd>
</dl>
<p>optical fluctuation imaging.” bioRxiv: 545574 (2019).</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pysofi.reconstruction.block_ave_moments">
<span class="sig-prename descclassname"><span class="pre">pysofi.reconstruction.</span></span><span class="sig-name descname"><span class="pre">block_ave_moments</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filepath</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">highest_order</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">smooth_kernel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">251</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fbc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.04</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.reconstruction.block_ave_moments" title="Permalink to this definition">¶</a></dt>
<dd><p>Get average moment-reconstructed images of all blocks determined by
user-defined noise filtering and bleaching correction factor (fbc).
Similar to ‘block_ave_cumulants’.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filepath</strong> (<em>str</em>) – Path to the tiff file.</p></li>
<li><p><strong>filename</strong> (<em>str</em>) – Name of the tiff file.</p></li>
<li><p><strong>highest_order</strong> (<em>int</em>) – The highest order number of moment-reconstructed images.</p></li>
<li><p><strong>smooth_kernel</strong> (<em>int</em>) – The size of the median filter (‘filtering.med_smooth’) window.</p></li>
<li><p><strong>fbc</strong> (<em>float</em>) – The fraction of signal decrease within each block compared to the
total signal decrease.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>ave_m_set</strong> – order number (int) -&gt; image (ndarray)
A dictionary of avereage moment-reconstructed images of all blocks.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pysofi.reconstruction.calc_block_moments">
<span class="sig-prename descclassname"><span class="pre">pysofi.reconstruction.</span></span><span class="sig-name descname"><span class="pre">calc_block_moments</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filepath</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">highest_order</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">frames</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.reconstruction.calc_block_moments" title="Permalink to this definition">¶</a></dt>
<dd><p>Get moment-reconstructed images for user-defined frames (block) of
a video file(tiff stack).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filepath</strong> (<em>str</em>) – Path to the tiff file.</p></li>
<li><p><strong>filename</strong> (<em>str</em>) – Name of the tiff file.</p></li>
<li><p><strong>highest_order</strong> (<em>int</em>) – The highest order number of moment-reconstructed images.</p></li>
<li><p><strong>frames</strong> (<em>list of int</em>) – Start and end frame number.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>m_set</strong> – order number (int) -&gt; image (ndarray)
A dictionary of calcualted moment-reconstructed images.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Similar to ‘calc_moments’. Here we omit previously calculated m_set
and mean_im as inputs since a block usually has much fewer number of
frames and takes shorter calculation time.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pysofi.reconstruction.calc_cumulants_from_moments">
<span class="sig-prename descclassname"><span class="pre">pysofi.reconstruction.</span></span><span class="sig-name descname"><span class="pre">calc_cumulants_from_moments</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">moment_set</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.reconstruction.calc_cumulants_from_moments" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate cumulant images from moment images using the recursive relation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>moment_set</strong> (<em>dict</em>) – order number (int) -&gt; image (ndarray)
A dictionary of calcualted moment- images.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>k_set</strong> – order number (int) -&gt; image (ndarray)
A dictionary of calcualted cumulant-reconstructed images.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pysofi.reconstruction.calc_cumulants_from_moments_with_lag">
<span class="sig-prename descclassname"><span class="pre">pysofi.reconstruction.</span></span><span class="sig-name descname"><span class="pre">calc_cumulants_from_moments_with_lag</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">m_set</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tauSeries</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.reconstruction.calc_cumulants_from_moments_with_lag" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate cumulant-reconstructed images from moment-reconstructed images
with time lags.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>m_set</strong> (<em>dict</em>) – order (int) -&gt; dict (partition (tuple) -&gt; image (ndarray))
A nested dictionary of moment-reconstructions of all partitions that
calculated from ‘calc_moments_with_lag’.</p></li>
<li><p><strong>tauSeries</strong> (<em>list of int</em>) – A list of time lags for frames contribute to moment reconstruction.
The first element is recommended to be 0, and there should be seven
elements in the list. The values should be the same as the input for
‘calc_moments_with_lag’.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>k_set</strong> – order number (int) -&gt; image (ndarray)
A dictionary of calcualted cumulant-reconstructed images with time
lags.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pysofi.reconstruction.calc_moment_im">
<span class="sig-prename descclassname"><span class="pre">pysofi.reconstruction.</span></span><span class="sig-name descname"><span class="pre">calc_moment_im</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filepath</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">order</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">frames</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mean_im</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.reconstruction.calc_moment_im" title="Permalink to this definition">¶</a></dt>
<dd><p>Get one moment-reconstructed image of a defined order for a video file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filepath</strong> (<em>str</em>) – Path to the tiff file.</p></li>
<li><p><strong>filename</strong> (<em>str</em>) – Name of the tiff file.</p></li>
<li><p><strong>order</strong> (<em>int</em>) – The order number of moment-reconstructed image.</p></li>
<li><p><strong>frames</strong> (<em>list of int</em>) – The start and end frame number.</p></li>
<li><p><strong>mean_im</strong> (<em>ndarray</em>) – Average image of the tiff stack.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>moment_im</strong> – The moments-reconstructed image.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pysofi.reconstruction.calc_moments">
<span class="sig-prename descclassname"><span class="pre">pysofi.reconstruction.</span></span><span class="sig-name descname"><span class="pre">calc_moments</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filepath</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">highest_order</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">frames</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">m_set</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mean_im</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.reconstruction.calc_moments" title="Permalink to this definition">¶</a></dt>
<dd><p>Get all moment-reconstructed images to the user-defined highest order for
a video file(tiff stack).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filepath</strong> (<em>str</em>) – Path to the tiff file.</p></li>
<li><p><strong>filename</strong> (<em>str</em>) – Name of the tiff file.</p></li>
<li><p><strong>highest_order</strong> (<em>int</em>) – The highest order number of moment-reconstructed images.</p></li>
<li><p><strong>frames</strong> (<em>list of int</em>) – The start and end frame number.</p></li>
<li><p><strong>m_set</strong> (<em>dict</em>) – order number (int) -&gt; image (ndarray)
A dictionary of previously calcualted moment-reconstructed images.</p></li>
<li><p><strong>mean_im</strong> (<em>ndarray</em>) – Average image of the tiff stack.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>m_set</strong> – order number (int) -&gt; image (ndarray)
A dictionary of calcualted moment-reconstructed images.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pysofi.reconstruction.calc_moments_with_lag">
<span class="sig-prename descclassname"><span class="pre">pysofi.reconstruction.</span></span><span class="sig-name descname"><span class="pre">calc_moments_with_lag</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filepath</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tauSeries</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">frames</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.reconstruction.calc_moments_with_lag" title="Permalink to this definition">¶</a></dt>
<dd><p>Get moment-reconnstructed images with defined time lags.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filepath</strong> (<em>str</em>) – Path to the tiff file.</p></li>
<li><p><strong>filename</strong> (<em>str</em>) – Name of the tiff file.</p></li>
<li><p><strong>tauSeries</strong> (<em>list of int</em>) – A list of time lags for frames contribute to moment reconstruction.
The first element is recommended to be 0, and there should seven
elements in the list.</p></li>
<li><p><strong>frames</strong> (<em>list of int</em>) – The start and end frame number.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>m_set</strong> – order (int) -&gt; dict (partition (tuple) -&gt; image (ndarray))
A nested dictionary of moment-reconstructions of all partitions.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pysofi.reconstruction.calc_total_signal">
<span class="sig-prename descclassname"><span class="pre">pysofi.reconstruction.</span></span><span class="sig-name descname"><span class="pre">calc_total_signal</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filepath</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.reconstruction.calc_total_signal" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the total signal intensity of each frame for the whole
video (tiff stack).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filepath</strong> (<em>str</em>) – Path to the tiff file.</p></li>
<li><p><strong>filename</strong> (<em>str</em>) – Name of the tiff file.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>total_signal</strong> – Signal intensity of each frame ordered by the frame number.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>1darray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pysofi.reconstruction.calc_xc_im">
<span class="sig-prename descclassname"><span class="pre">pysofi.reconstruction.</span></span><span class="sig-name descname"><span class="pre">calc_xc_im</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filepath</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ri_range</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">frames</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.reconstruction.calc_xc_im" title="Permalink to this definition">¶</a></dt>
<dd><p>Get cross-cumulant image with different pixel combinations.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filepath</strong> (<em>str</em>) – Path to the tiff file.</p></li>
<li><p><strong>filename</strong> (<em>str</em>) – Name of the tiff file.</p></li>
<li><p><strong>ri_range</strong> (<em>int</em>) – Maximium distance (# pixels) between the original the selected pixel.</p></li>
<li><p><strong>frames</strong> (<em>list of int</em>) – The start and end frame number.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>xc</strong> – pixel (tuple) -&gt; image (ndarray)
A dictionary of reconstructed images with pixel index as keys.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pysofi.reconstruction.correct_bleaching">
<span class="sig-prename descclassname"><span class="pre">pysofi.reconstruction.</span></span><span class="sig-name descname"><span class="pre">correct_bleaching</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filepath</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fbc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.04</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">smooth_kernel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">251</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_option</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_option</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.reconstruction.correct_bleaching" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs bleaching correction on a tiff image (stack).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fbc</strong> (<em>float</em>) – The fraction of signal decrease within each block compared
to the total signal decrease. Only used when bleach correction
is True.</p></li>
<li><p><strong>smooth_kernel</strong> (<em>int</em>) – The size of the median filter window.</p></li>
<li><p><strong>save_option</strong> (<em>bool</em>) – Whether to save the corrected images into tiff files.</p></li>
<li><p><strong>return_option</strong> (<em>bool</em>) – Whether to return the corrected image series as a 3d array.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>bc_im</strong> – All bleaching-corrected imagee in a 3d array.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pysofi.reconstruction.cumulants_all_blocks">
<span class="sig-prename descclassname"><span class="pre">pysofi.reconstruction.</span></span><span class="sig-name descname"><span class="pre">cumulants_all_blocks</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">m_set_all_blocks</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.reconstruction.cumulants_all_blocks" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate cumulant-reconstructed images from moment-reconstructed images
of each block. Similar to ‘calc_cumulants_from_moments’.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pysofi.reconstruction.cut_frames">
<span class="sig-prename descclassname"><span class="pre">pysofi.reconstruction.</span></span><span class="sig-name descname"><span class="pre">cut_frames</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">signal_level</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fbc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.04</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.reconstruction.cut_frames" title="Permalink to this definition">¶</a></dt>
<dd><p>Find the list of frame number to cut the whole signal plot into seperate
blocks based on the change of total signal intensity.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>signal_level</strong> (<em>1darray</em>) – Signal change over time (can be derived from ‘calc_total_signal’).</p></li>
<li><p><strong>fbc</strong> (<em>float</em>) – The fraction of signal decrease within each block compared to the
total signal decrease.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>bounds</strong> (<em>list of int</em>) – Signal intensities on the boundary of each block.</p></li>
<li><p><strong>frame_lst</strong> (<em>list of int</em>) – Frame number where to cut the whole signal plot into blocks.</p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The number of blocks is the inverse of the bleaching correction factor,
fbc. For instance, if fbc=0.04, it means that in each block, the
decrease in signal intensity is 4% if the total decrease, and the whole
plot / video is cut into 25 blocks. For some data, it is possible that
the maximun signal intensity does not appear at the beginning of the
signal plot. Here, we consider all frames before the maximum in the
same block as the maximum frame / intensity since usually the number
of frames is not too large. The user can add in extra blocks if the
initial intensity is much smaller than the maximum.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pysofi.reconstruction.min_image">
<span class="sig-prename descclassname"><span class="pre">pysofi.reconstruction.</span></span><span class="sig-name descname"><span class="pre">min_image</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filepath</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">frames</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.reconstruction.min_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the minimum image for a video file (tiff stack), either for the
whole video or for user defined frames.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filepath</strong> (<em>str</em>) – Path to the tiff file.</p></li>
<li><p><strong>filename</strong> (<em>str</em>) – Name of the tiff file.</p></li>
<li><p><strong>frames</strong> (<em>list of int</em><em>, </em><em>optional</em>) – Start and end frame number if not the whole video is used.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>min_im</strong> – The minimum image.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pysofi.reconstruction.moment_im_with_finterp">
<span class="sig-prename descclassname"><span class="pre">pysofi.reconstruction.</span></span><span class="sig-name descname"><span class="pre">moment_im_with_finterp</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filepath</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">order</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">interp_num</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">frames</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mean_im</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.reconstruction.moment_im_with_finterp" title="Permalink to this definition">¶</a></dt>
<dd><p>Get one moment-reconstructed image of a defined order for a video file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filepath</strong> (<em>str</em>) – Path to the tiff file.</p></li>
<li><p><strong>filename</strong> (<em>str</em>) – Name of the tiff file.</p></li>
<li><p><strong>order</strong> (<em>int</em>) – The order number of moment-reconstructed image.</p></li>
<li><p><strong>interp_num</strong> (<em>int</em>) – The interpolation factor.</p></li>
<li><p><strong>mvlength</strong> (<em>int</em>) – The length of video for the reconstruction.</p></li>
<li><p><strong>mean_im</strong> (<em>ndarray</em>) – Average image of the tiff stack.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>moment_im</strong> – The moments-reconstructed image.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pysofi.reconstruction.moments_all_blocks">
<span class="sig-prename descclassname"><span class="pre">pysofi.reconstruction.</span></span><span class="sig-name descname"><span class="pre">moments_all_blocks</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filepath</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">highest_order</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">smooth_kernel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">251</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fbc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.04</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.reconstruction.moments_all_blocks" title="Permalink to this definition">¶</a></dt>
<dd><p>Get moment-reconstructed images for seperate blocks with user-defined
noise filtering and bleaching correction factor (fbc).</p>
<p>Within each block, the amount of signal decrease is identical. This
amount of signal decrease is characterized by the bleaching correction
factor, fbc, which is the fractional signal decrease within each block
(as compared to the total signal decrease over the whole signal plot).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filepath</strong> (<em>str</em>) – Path to the tiff file.</p></li>
<li><p><strong>filename</strong> (<em>str</em>) – Name of the tiff file.</p></li>
<li><p><strong>highest_order</strong> (<em>int</em>) – The highest order number of moment-reconstructed images.</p></li>
<li><p><strong>smooth_kernel</strong> (<em>int</em>) – The size of the median filter (‘filtering.med_smooth’) window.</p></li>
<li><p><strong>fbc</strong> (<em>float</em>) – The fraction of signal decrease within each block compared to the
total signal decrease.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>m_set_all_blocks</strong> – block_number (int) -&gt; {order number (int) -&gt; image (ndarray)}
A dictionary of moment-reconstructed images of each block.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Similar to ‘calc_moments’. Here we omit previously calculated m_set
and mean_im as inputs since a block usually has much fewer number of
frames and takes shorter calculation time.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pysofi.reconstruction.sorted_k_partitions">
<span class="sig-prename descclassname"><span class="pre">pysofi.reconstruction.</span></span><span class="sig-name descname"><span class="pre">sorted_k_partitions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">seq</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">k</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.reconstruction.sorted_k_partitions" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a list of all unique k-partitions of <cite>seq</cite>.
Each partition is a list of parts, and each part is a tuple.</p>
</dd></dl>

</section>
<section id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>To calculate fourth-order moment-reconstructed image using frame 50 to 100 of the input video
with FOurier interpolation (factor=2):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">m_im</span> <span class="o">=</span> <span class="n">reconstruction</span><span class="o">.</span><span class="n">moment_im_with_finterp</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">interp_num</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">frames</span><span class="o">=</span><span class="p">[</span><span class="mi">50</span><span class="p">,</span><span class="mi">100</span><span class="p">])</span>
</pre></div>
</div>
<p>To calculate up to the fourth-order cumulant-reconstructed image:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">m_set</span> <span class="o">=</span> <span class="n">reconstruction</span><span class="o">.</span><span class="n">calc_moments</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">highest_order</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">k_set</span> <span class="o">=</span> <span class="n">reconstruction</span><span class="o">.</span><span class="n">calc_cumulants_from_moments</span><span class="p">(</span><span class="n">m_set</span><span class="p">)</span>
</pre></div>
</div>
<p>To calculate the average moment reconstruction by dividing the whol video into 25 blocks, and in each block the
signal decrease is 4% of the total signal decrease:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mean_mim</span> <span class="o">=</span> <span class="n">reconstruction</span><span class="o">.</span><span class="n">block_ave_moments</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">smooth_kernel</span><span class="o">=</span><span class="mi">251</span><span class="p">,</span> <span class="n">fbc</span><span class="o">=</span><span class="mf">0.04</span><span class="p">)</span>
</pre></div>
</div>
<p>To perform bleaching correction on a input video and save the corrected images in a new tiff file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">reconstruction</span><span class="o">.</span><span class="n">correct_bleaching</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">fbc</span><span class="o">=</span><span class="mf">0.04</span><span class="p">,</span> <span class="n">smooth_kernel</span><span class="o">=</span><span class="mi">251</span><span class="p">,</span>
                                 <span class="n">save_option</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">return_option</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="index.html">Table of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="start.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="demos.html">Demos</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="manual.html">Reference manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="manual.html#introduction">Introduction</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="manual.html#modules">Modules</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="finterp.html"
                        title="previous chapter">Fourier Interpolation Module</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="filter.html"
                        title="next chapter">Noise Filtration</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/reconstruction.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="filter.html" title="Noise Filtration"
             >next</a> |</li>
        <li class="right" >
          <a href="finterp.html" title="Fourier Interpolation Module"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">pysofi 0.1.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="manual.html" >PySOFI Reference Manual</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Reconstruction Options</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Yuting Miao.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.2.0.
    </div>
  </body>
</html>