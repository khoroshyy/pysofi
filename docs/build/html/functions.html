
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>pysofi package &#8212; pysofi 0.1.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/classic.css" />
    
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">pysofi 0.1.1 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">pysofi package</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="pysofi-package">
<h1>pysofi package<a class="headerlink" href="#pysofi-package" title="Permalink to this headline">¶</a></h1>
<section id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this headline">¶</a></h2>
</section>
<section id="module-pysofi.pysofi">
<span id="pysofi-pysofi-module"></span><h2>pysofi.pysofi module<a class="headerlink" href="#module-pysofi.pysofi" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="pysofi.pysofi.PysofiData">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">pysofi.pysofi.</span></span><span class="sig-name descname"><span class="pre">PysofiData</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filepath</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.pysofi.PysofiData" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Data object contains the information of a dataset (e.g. dimensions,
frame numbers), and provides SOFI methods to perform analysis and
visualization on the dataset (moments reconstruction, cumulants
reconstruction, shrinking kernel deconvolution, etc…).</p>
<p>When loading a tiff file, a PysofiData() object is created and further
SOFI analysis can be preformed. All the standard data-attributes
are listed below. New data-attributes can be added or updated using
‘.add()’ function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filapath</strong> (<em>str</em>) – Path to the tiff file.</p></li>
<li><p><strong>filename</strong> (<em>str</em>) – Name of the tiff file.</p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="pysofi.pysofi.PysofiData.filename">
<span class="sig-name descname"><span class="pre">filename</span></span><a class="headerlink" href="#pysofi.pysofi.PysofiData.filename" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pysofi.pysofi.PysofiData.filepath">
<span class="sig-name descname"><span class="pre">filepath</span></span><a class="headerlink" href="#pysofi.pysofi.PysofiData.filepath" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pysofi.pysofi.PysofiData.ave">
<span class="sig-name descname"><span class="pre">ave</span></span><a class="headerlink" href="#pysofi.pysofi.PysofiData.ave" title="Permalink to this definition">¶</a></dt>
<dd><p>The average image of the image stack / tiff video.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pysofi.pysofi.PysofiData.finterp_factor">
<span class="sig-name descname"><span class="pre">finterp_factor</span></span><a class="headerlink" href="#pysofi.pysofi.PysofiData.finterp_factor" title="Permalink to this definition">¶</a></dt>
<dd><p>The interpolation factor for Fourier interpolation.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pysofi.pysofi.PysofiData.morder_lst">
<span class="sig-name descname"><span class="pre">morder_lst</span></span><a class="headerlink" href="#pysofi.pysofi.PysofiData.morder_lst" title="Permalink to this definition">¶</a></dt>
<dd><p>All orders of moments-reconstructions that have been calculated.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pysofi.pysofi.PysofiData.morder_finterp_lst">
<span class="sig-name descname"><span class="pre">morder_finterp_lst</span></span><a class="headerlink" href="#pysofi.pysofi.PysofiData.morder_finterp_lst" title="Permalink to this definition">¶</a></dt>
<dd><p>All orders of moments-reconstructions after Fourier interpolation
that have been calculated.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pysofi.pysofi.PysofiData.moments_set">
<span class="sig-name descname"><span class="pre">moments_set</span></span><a class="headerlink" href="#pysofi.pysofi.PysofiData.moments_set" title="Permalink to this definition">¶</a></dt>
<dd><p>moment order (int) -&gt; moment-reconstructed image (ndarray)
A dictionary of orders and corrensponding moment reconstructions.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pysofi.pysofi.PysofiData.moments_set_bc">
<span class="sig-name descname"><span class="pre">moments_set_bc</span></span><a class="headerlink" href="#pysofi.pysofi.PysofiData.moments_set_bc" title="Permalink to this definition">¶</a></dt>
<dd><p>moment order (int) -&gt; moment-reconstructed image (ndarray)
A dictionary of orders and corrensponding moment reconstructions
with bleaching correction.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pysofi.pysofi.PysofiData.cumulants_set">
<span class="sig-name descname"><span class="pre">cumulants_set</span></span><a class="headerlink" href="#pysofi.pysofi.PysofiData.cumulants_set" title="Permalink to this definition">¶</a></dt>
<dd><p>cumulant order (int) -&gt; cumulant-reconstructed image (ndarray)
A dictionary of orders and corrensponding cumulant reconstructions.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pysofi.pysofi.PysofiData.cumulants_set_bc">
<span class="sig-name descname"><span class="pre">cumulants_set_bc</span></span><a class="headerlink" href="#pysofi.pysofi.PysofiData.cumulants_set_bc" title="Permalink to this definition">¶</a></dt>
<dd><p>cumulant order (int) -&gt; cumulant-reconstructed image (ndarray)
A dictionary of orders and corrensponding cumulant reconstructions
with bleaching correction.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pysofi.pysofi.PysofiData.morder">
<span class="sig-name descname"><span class="pre">morder</span></span><a class="headerlink" href="#pysofi.pysofi.PysofiData.morder" title="Permalink to this definition">¶</a></dt>
<dd><p>The highest order of moment reconstruction that has been calculated.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pysofi.pysofi.PysofiData.corder">
<span class="sig-name descname"><span class="pre">corder</span></span><a class="headerlink" href="#pysofi.pysofi.PysofiData.corder" title="Permalink to this definition">¶</a></dt>
<dd><p>The highest order of cumulant reconstruction that has been
calculated.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pysofi.pysofi.PysofiData.fbc">
<span class="sig-name descname"><span class="pre">fbc</span></span><a class="headerlink" href="#pysofi.pysofi.PysofiData.fbc" title="Permalink to this definition">¶</a></dt>
<dd><p>Bleaching correction factor.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pysofi.pysofi.PysofiData.n_frames">
<span class="sig-name descname"><span class="pre">n_frames</span></span><a class="headerlink" href="#pysofi.pysofi.PysofiData.n_frames" title="Permalink to this definition">¶</a></dt>
<dd><p>The number of frames of the image stack / tiff video.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pysofi.pysofi.PysofiData.xdim">
<span class="sig-name descname"><span class="pre">xdim</span></span><a class="headerlink" href="#pysofi.pysofi.PysofiData.xdim" title="Permalink to this definition">¶</a></dt>
<dd><p>The number of pixels in x dimension.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pysofi.pysofi.PysofiData.ydim">
<span class="sig-name descname"><span class="pre">ydim</span></span><a class="headerlink" href="#pysofi.pysofi.PysofiData.ydim" title="Permalink to this definition">¶</a></dt>
<dd><p>The number of pixels in y dimension.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<p class="rubric">Notes</p>
<p>For SOFI processing, after loading the tiff video into the Data object,
a pipeline of 1) fourier interpolation, 2) moments reconstrtuction or
cumulants reconstruction, 3) noise filtering 1, 4) shrinking kernel de-
convolution, 5) noise filtering 2, and 6) ldrc. The processed video will
be saved into a new tiff file with the colormap user selects.</p>
<p class="rubric">References</p>
<dl class="footnote brackets">
<dt class="label" id="id1"><span class="brackets">1</span></dt>
<dd><p>Xiyu Yi, Sungho Son, Ryoko Ando, Atsushi Miyawaki, and Shimon Weiss,</p>
</dd>
</dl>
<p>“Moments reconstruction and local dynamic range compression of high order
superresolution optical fluctuation imaging,” Biomed. Opt. Express 10,
2430-2445 (2019).</p>
<dl class="py method">
<dt class="sig sig-object py" id="pysofi.pysofi.PysofiData.add">
<span class="sig-name descname"><span class="pre">add</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.pysofi.PysofiData.add" title="Permalink to this definition">¶</a></dt>
<dd><p>Add or update elements (attributes and/or dict entries).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pysofi.pysofi.PysofiData.add_filtered">
<span class="sig-name descname"><span class="pre">add_filtered</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filter_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'noise</span> <span class="pre">filter'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.pysofi.PysofiData.add_filtered" title="Permalink to this definition">¶</a></dt>
<dd><p>Add (noise) filtered image as an attribute of the object.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pysofi.pysofi.PysofiData.average_image">
<span class="sig-name descname"><span class="pre">average_image</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">frames</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.pysofi.PysofiData.average_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate average image of the tiff video.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pysofi.pysofi.PysofiData.average_image_with_finterp">
<span class="sig-name descname"><span class="pre">average_image_with_finterp</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">interp_num</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.pysofi.PysofiData.average_image_with_finterp" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pysofi.pysofi.PysofiData.bleach_correct">
<span class="sig-name descname"><span class="pre">bleach_correct</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fbc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.04</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">smooth_kernel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">251</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_option</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_option</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.pysofi.PysofiData.bleach_correct" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs bleaching correction on a tiff image (stack) with a
bleaching correction factor.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fbc</strong> (<em>float</em>) – The fraction of signal decrease within each block compared
to the total signal decrease. Only used when bleach correction
is True.</p></li>
<li><p><strong>smooth_kernel</strong> (<em>int</em>) – The size of the median filter window.</p></li>
<li><p><strong>save_option</strong> (<em>bool</em>) – Whether to save the corrected images into tiff files.</p></li>
<li><p><strong>return_option</strong> (<em>bool</em>) – Whether to return the corrected image series as a 3d array.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>bc_im</strong> – All bleaching-corrected imagee in a 3d array.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pysofi.pysofi.PysofiData.calc_moments_set">
<span class="sig-name descname"><span class="pre">calc_moments_set</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">highest_order</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">frames</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mean_im</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bleach_correction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">smooth_kernel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">251</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fbc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.04</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.pysofi.PysofiData.calc_moments_set" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate moment-reconstructed images to the highest order.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>highest_order</strong> (<em>int</em>) – The highest order number of moment-reconstructed images.</p></li>
<li><p><strong>frames</strong> (<em>list of int</em>) – The start and end frame number.</p></li>
<li><p><strong>mean_im</strong> (<em>ndarray</em>) – Average image of the tiff stack.</p></li>
<li><p><strong>bleach_correction</strong> (<em>bool</em>) – Whether to use bleaching correction.</p></li>
<li><p><strong>smooth_kernel</strong> (<em>int</em><em>, </em><em>optional</em>) – The size of the median filter window. Only used when bleach
correction is True.</p></li>
<li><p><strong>fbc</strong> (<em>float</em><em>, </em><em>optional</em>) – The fraction of signal decrease within each block compared
to the total signal decrease. Only used when bleach correction
is True.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>moments_set, moments_set_bc</strong> – order number (int) -&gt; image (ndarray)
A dictionary of calcualted moment-reconstructed images.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pysofi.pysofi.PysofiData.cumulants_images">
<span class="sig-name descname"><span class="pre">cumulants_images</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">highest_order</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">frames</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">m_set</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bleach_correction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">smooth_kernel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">251</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fbc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.04</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.pysofi.PysofiData.cumulants_images" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate cumulant-reconstructed images to the highest order.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>highest_order</strong> (<em>int</em>) – The highest order number of cumulant-reconstructed images.</p></li>
<li><p><strong>frames</strong> (<em>list of int</em>) – The start and end frame number.</p></li>
<li><p><strong>m_set</strong> (<em>dict</em>) – order number (int) -&gt; image (ndarray)
A dictionary of calcualted moment-reconstructed images.</p></li>
<li><p><strong>bleach_correction</strong> (<em>bool</em>) – Whether to use bleaching correction.</p></li>
<li><p><strong>smooth_kernel</strong> (<em>int</em><em>, </em><em>optional</em>) – The size of the median filter window. Only used when bleach
correction is True.</p></li>
<li><p><strong>fbc</strong> (<em>float</em><em>, </em><em>optional</em>) – The fraction of signal decrease within each block compared
to the total signal decrease. Only used when bleach correction
is True.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>cumulants_set, cumulants_set_bc</strong> – order number (int) -&gt; image (ndarray)
A dictionary of calcualted cumulant-reconstructed images.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pysofi.pysofi.PysofiData.deconvsk">
<span class="sig-name descname"><span class="pre">deconvsk</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">est_psf</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">array([[0.0,</span> <span class="pre">0.0,</span> <span class="pre">0.0,</span> <span class="pre">...,</span> <span class="pre">0.0,</span> <span class="pre">0.0,</span> <span class="pre">0.0],</span> <span class="pre">[0.0,</span> <span class="pre">0.0,</span> <span class="pre">0.0,</span> <span class="pre">...,</span> <span class="pre">0.0,</span> <span class="pre">0.0,</span> <span class="pre">0.0],</span> <span class="pre">[0.0,</span> <span class="pre">0.0,</span> <span class="pre">0.0,</span> <span class="pre">...,</span> <span class="pre">0.0,</span> <span class="pre">0.0,</span> <span class="pre">0.0],</span> <span class="pre">...,</span> <span class="pre">[0.0,</span> <span class="pre">0.0,</span> <span class="pre">0.0,</span> <span class="pre">...,</span> <span class="pre">0.0,</span> <span class="pre">0.0,</span> <span class="pre">0.0],</span> <span class="pre">[0.0,</span> <span class="pre">0.0,</span> <span class="pre">0.0,</span> <span class="pre">...,</span> <span class="pre">0.0,</span> <span class="pre">0.0,</span> <span class="pre">0.0],</span> <span class="pre">[0.0,</span> <span class="pre">0.0,</span> <span class="pre">0.0,</span> <span class="pre">...,</span> <span class="pre">0.0,</span> <span class="pre">0.0,</span> <span class="pre">0.0]])</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">input_im</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">deconv_lambda</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">deconv_iter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.pysofi.PysofiData.deconvsk" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform serial Richardson-Lucy deconvolution with a series of PSFs
on the input image. For details of shrinking kernel deconvolution,
refer to deconvsk.py and [1].</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>est_psf</strong> (<em>ndarray</em>) – Estimated PSF.</p></li>
<li><p><strong>input_im</strong> (<em>ndarray</em>) – Input image that need deconvolution.</p></li>
<li><p><strong>deconv_lambda</strong> (<em>float</em>) – Lambda for the exponent between. It is an empirical parameter
within the range of (1,2).</p></li>
<li><p><strong>deconv_iter</strong> (<em>int</em>) – Number of iterations for each deconvolution.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>deconv</strong> – Deconvoluted image.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pysofi.pysofi.PysofiData.finterp_image">
<span class="sig-name descname"><span class="pre">finterp_image</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_im</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">interp_num_lst</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[2,</span> <span class="pre">4]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.pysofi.PysofiData.finterp_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs fourier interpolation on an image array.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pysofi.pysofi.PysofiData.finterp_tiffstack">
<span class="sig-name descname"><span class="pre">finterp_tiffstack</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">interp_num_lst</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[2,</span> <span class="pre">4]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">frames</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_option</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_option</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.pysofi.PysofiData.finterp_tiffstack" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs fourier interpolation on a tiff image (stack) with a list of
interpolation factors (the number of pixels to be interpolated between
two adjacent pixels).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>interp_num_lst</strong> (<em>list</em><em> (</em><em>int</em><em>)</em>) – A list of interpolation factors.</p></li>
<li><p><strong>frames</strong> (<em>list of int</em>) – The start and end frame number.</p></li>
<li><p><strong>save_option</strong> (<em>bool</em>) – Whether to save the interpolated images into tiff files (each
interpolation factor seperately).</p></li>
<li><p><strong>return_option</strong> (<em>bool</em>) – Whether to return the interpolated image series as 3d arrays.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>finterps</strong> – A list of interpolated image sereis corresponding to the interpolation
factor list.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>list (ndarray)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pysofi.pysofi.PysofiData.get_dims">
<span class="sig-name descname"><span class="pre">get_dims</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.pysofi.PysofiData.get_dims" title="Permalink to this definition">¶</a></dt>
<dd><p>Get dimensions and frame number of the tiff video.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pysofi.pysofi.PysofiData.get_frame">
<span class="sig-name descname"><span class="pre">get_frame</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">frame_num</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.pysofi.PysofiData.get_frame" title="Permalink to this definition">¶</a></dt>
<dd><p>Get one frame of the tiff video.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>frame_num</strong> (<em>int</em>) – The frame number (e.g. 0 for the first frame).</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>frame_im</strong> – Frame array.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pysofi.pysofi.PysofiData.ldrc">
<span class="sig-name descname"><span class="pre">ldrc</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">order</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">6</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">window_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[25,</span> <span class="pre">25]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask_im</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">input_im</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.pysofi.PysofiData.ldrc" title="Permalink to this definition">¶</a></dt>
<dd><p>Compress the dynamic range of moments-/cumulants reconstruced image
with ldrc method. For details of ldrc, refer to ldrc.py and [1].</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>order</strong> (<em>int</em>) – The order of the reconstructed image.</p></li>
<li><p><strong>window_size</strong> (<em>[</em><em>int</em><em>, </em><em>int</em><em>]</em>) – The [x, y] dimension of the scanning window.</p></li>
<li><p><strong>mask_im</strong> (<em>ndarray</em>) – A reference image.
Usually a average/sum image or second-order SOFI image is used.</p></li>
<li><p><strong>input_im</strong> (<em>ndarray</em>) – An input image, usually a high-order moment- or cumulant-
reconstructed image.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>ldrc_image</strong> – The compressed image with the same dimensions of input_im.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pysofi.pysofi.PysofiData.moment_image">
<span class="sig-name descname"><span class="pre">moment_image</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">order</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">6</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mean_im</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mvlength</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">finterp</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">interp_num</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.pysofi.PysofiData.moment_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the moment-reconstructed image of a defined order.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>order</strong> (<em>int</em>) – The order number of the moment-reconstructed image.</p></li>
<li><p><strong>mean_im</strong> (<em>ndarray</em>) – Average image of the tiff stack.</p></li>
<li><p><strong>mvlength</strong> (<em>int</em>) – Length of the video to calculate moments-reconstruction.</p></li>
<li><p><strong>finterp</strong> (<em>bool</em>) – Whether to first conduct Fourier interpolation then calculate
moments-reconstructions.</p></li>
<li><p><strong>interp_num</strong> (<em>int</em>) – The interpolation factor.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>moment_im</strong> – The calculated moment-reconstructed image.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="module-pysofi.deconvsk">
<span id="pysofi-deconvsk-module"></span><h2>pysofi.deconvsk module<a class="headerlink" href="#module-pysofi.deconvsk" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="pysofi.deconvsk.corelucy">
<span class="sig-prename descclassname"><span class="pre">pysofi.deconvsk.</span></span><span class="sig-name descname"><span class="pre">corelucy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">h</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.deconvsk.corelucy" title="Permalink to this definition">¶</a></dt>
<dd><p>Make core for the LR estimation. Calculates f to produce the next
iteration array that maximizes the likelihood that the entire suite
satisfies the Poisson statistics.
This is a simplified version of MATLAB corelucy function without
damping, weights and externally defined functions.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image</strong> (<em>ndarray</em>) – Input image.</p></li>
<li><p><strong>h</strong> (<em>ndarray</em>) – Zero-padded OTF. h should have the same dimensions as image.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>f</strong> – LR extimation core.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
<p class="rubric">References</p>
<dl class="footnote brackets">
<dt class="label" id="id2"><span class="brackets">1</span></dt>
<dd><p>Acceleration of iterative image restoration algorithms, by D.S.C. Biggs</p>
</dd>
</dl>
<p>and M. Andrews, Applied Optics, Vol. 36, No. 8, 1997.
.. [2] Deconvolutions of Hubble Space Telescope Images and Spectra,
R.J. Hanisch, R.L. White, and R.L. Gilliland. in “Deconvolution of Images
and Spectra”, Ed. P.A. Jansson, 2nd ed., Academic Press, CA, 1997.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pysofi.deconvsk.deconvsk">
<span class="sig-prename descclassname"><span class="pre">pysofi.deconvsk.</span></span><span class="sig-name descname"><span class="pre">deconvsk</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">est_psf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">input_im</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">deconv_lambda</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">deconv_iter</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.deconvsk.deconvsk" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform serial Richardson-Lucy deconvolution with shrinking PSFs.
U = (U**(l/(l-1))) * (U**(l**2/(l-1))) * … * (U**(l**n/(l-1))).
The PSF of the imaging system U can be decomposed into a series a
smaller (shrinking) PSF U**r where r &gt; 1, and the image can be
deconvolved by these PSFs in sequence.
In this way, the result is more similar to the input image, so each
individual deconvolution step is a lighter deconcolution task.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>est_psf</strong> (<em>ndarray</em>) – Estimated PSF.</p></li>
<li><p><strong>input_im</strong> (<em>ndarray</em>) – Input image that need deconvolution.</p></li>
<li><p><strong>deconv_lambda</strong> (<em>float</em>) – Lambda for the exponent between. It is an empirical parameter
within the range of (1,2).</p></li>
<li><p><strong>deconv_iter</strong> (<em>int</em>) – Number of iterations for each deconvolution.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>deconv_im</strong> – Deconvoluted image.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The quality of the deconvolution result is greatly dependent on the initial
PSF size instead of the value. We recommend to calibrate PSF of the imaging
system and use that as the initial PSF guess. Otherwise, generating a PSF
according to the magnification of the imaging system is an option. For more
details on the shrinking kernel deconvolution method, please refer to [1].</p>
<p class="rubric">References</p>
<dl class="footnote brackets">
<dt class="label" id="id3"><span class="brackets">1</span></dt>
<dd><p>Xiyu Yi, Sungho Son, Ryoko Ando, Atsushi Miyawaki, and Shimon Weiss,</p>
</dd>
</dl>
<p>“Moments reconstruction and local dynamic range compression of high order
superresolution optical fluctuation imaging,” Biomed. Opt. Express 10,
2430-2445 (2019).</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pysofi.deconvsk.otf2psf">
<span class="sig-prename descclassname"><span class="pre">pysofi.deconvsk.</span></span><span class="sig-name descname"><span class="pre">otf2psf</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">otf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shape</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.deconvsk.otf2psf" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert optical transfer function (OTF) to point-spread function (PSF).
Compute the Inverse Fast Fourier Transform (ifft) of the OTF array and
creates the PSF array that is not influenced by the OTF off-centering.
By default, the PSF array is the same size as the OTF array.
Adapted from MATLAB otf2psf function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>otf</strong> (<em>ndarray</em>) – OTF array.</p></li>
<li><p><strong>shape</strong> (<em>list</em><em> (</em><em>int</em><em>)</em>) – Output shape of the OTF array.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>psf</strong> – PSF array.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pysofi.deconvsk.psf2otf">
<span class="sig-prename descclassname"><span class="pre">pysofi.deconvsk.</span></span><span class="sig-name descname"><span class="pre">psf2otf</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">psf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shape</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.deconvsk.psf2otf" title="Permalink to this definition">¶</a></dt>
<dd><p>From https: // github.com/aboucaud/pypher/blob/master/pypher/pypher.py.
Convert point-spread function to optical transfer function.
Compute the Fast Fourier Transform(FFT) of the point-spread
function(PSF) array and creates the optical transfer function(OTF)
array that is not influenced by the PSF off-centering.
By default, the OTF array is the same size as the PSF array.
To ensure that the OTF is not altered due to PSF off-centering, PSF2OTF
post-pads the PSF array(down or to the right) with zeros to match
dimensions specified in OUTSIZE, then circularly shifts the values of
the PSF array up ( or to the left) until the central pixel reaches (1, 1)
position.
Adapted from MATLAB psf2otf function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>psf</strong> (<em>ndarray</em>) – PSF array.</p></li>
<li><p><strong>shape</strong> (<em>list</em><em>(</em><em>int</em><em>)</em>) – Output shape of the OTF array.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>otf</strong> – OTF array.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pysofi.deconvsk.richardson_lucy">
<span class="sig-prename descclassname"><span class="pre">pysofi.deconvsk.</span></span><span class="sig-name descname"><span class="pre">richardson_lucy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">psf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iterations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.deconvsk.richardson_lucy" title="Permalink to this definition">¶</a></dt>
<dd><p>Richardson-Lucy deconvolution. It deconvolves image using maximum
likelihood algorithm, returning both deblurred image J and a restored
point-spread function PSF.
This is a simplified version of MATLAB deconvblind function without
damping, weights and externally defined functions.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image</strong> (<em>ndarray</em>) – Input degraded image.</p></li>
<li><p><strong>psf</strong> (<em>ndarray</em>) – The point spread function.</p></li>
<li><p><strong>iterations</strong> (<em>int</em>) – Number of iterations.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>P</strong> (<em>ndarray</em>) – Restored point-spread function PSF.</p></li>
<li><p><strong>J</strong> (<em>ndarray</em>) – Deblurred image.</p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">scipy.ndimage.gaussian_filter</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">image</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">,::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">image</span><span class="p">[::</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">psf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">psf</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">psf</span> <span class="o">=</span> <span class="n">gaussian_filter</span><span class="p">(</span><span class="n">psf</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">7</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_psf</span><span class="p">,</span> <span class="n">deconv_im</span> <span class="o">=</span> <span class="n">richardson_lucy</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">psf</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
<p class="rubric">Notes</p>
<p>The quality of the deconvolution result is greatly dependent on the initial
PSF size instead of the value. We recommend to calibrate PSF of the imaging
system and use that as the initial PSF guess. Otherwise, generating a PSF
according to the magnification of the imaging system is an option.</p>
<p class="rubric">References</p>
<dl class="footnote brackets">
<dt class="label" id="id4"><span class="brackets">1</span></dt>
<dd><p>http: // en.wikipedia.org/wiki/Richardson % E2 % 80 % 93Lucy_deconvolution</p>
</dd>
<dt class="label" id="id5"><span class="brackets">2</span></dt>
<dd><p>Biggs, D. S. C.; Andrews, M. Acceleration of Iterative Image</p>
</dd>
</dl>
<p>Restoration Algorithms. Applied Optics 1997, 36 (8), 1766.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pysofi.deconvsk.zero_pad">
<span class="sig-prename descclassname"><span class="pre">pysofi.deconvsk.</span></span><span class="sig-name descname"><span class="pre">zero_pad</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shape</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">position</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'center'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.deconvsk.zero_pad" title="Permalink to this definition">¶</a></dt>
<dd><p>From https: // github.com/aboucaud/pypher/blob/master/pypher/pypher.py.
Extends image to a certain size with zeros.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image</strong> (<em>real 2d ndarray</em>) – Input image.</p></li>
<li><p><strong>shape</strong> (<em>tuple of list</em><em>(</em><em>int</em><em>)</em>) – Desired output shape of the image.</p></li>
<li><p><strong>position</strong> (<em>str</em><em>, </em><em>optional</em>) – <dl class="simple">
<dt>The position of the input image in the output one:</dt><dd><ul>
<li><dl class="simple">
<dt>’corner’</dt><dd><p>top-left corner(default)</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>’center’</dt><dd><p>centered</p>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>padded_img</strong> – The zero-padded image.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>real ndarray</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-pysofi.filtering">
<span id="pysofi-filtering-module"></span><h2>pysofi.filtering module<a class="headerlink" href="#module-pysofi.filtering" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="pysofi.filtering.filter1d_same">
<span class="sig-prename descclassname"><span class="pre">pysofi.filtering.</span></span><span class="sig-name descname"><span class="pre">filter1d_same</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">time_series</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">noise_filter</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.filtering.filter1d_same" title="Permalink to this definition">¶</a></dt>
<dd><p>Filter original time_series with noise_filter, and return the
filtered_series with the same length as the original sereis.
Compared to MATLAB results, when the length of the filter and
frame number are both even, the filtered result would shift to
left by one number. In other cases, results are the same.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pysofi.filtering.med_smooth">
<span class="sig-prename descclassname"><span class="pre">pysofi.filtering.</span></span><span class="sig-name descname"><span class="pre">med_smooth</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ori_signal</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kernel_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">251</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.filtering.med_smooth" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform a one-dimensional median filter with ‘reflect’ padding.
For more information, please check scipy.signal.medfilt.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pysofi.filtering.noise_filter1d">
<span class="sig-prename descclassname"><span class="pre">pysofi.filtering.</span></span><span class="sig-name descname"><span class="pre">noise_filter1d</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">im_set</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">noise_filter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filtername</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'noise</span> <span class="pre">filter</span> <span class="pre">after</span> <span class="pre">M6'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filenames</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_option</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'dict'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.filtering.noise_filter1d" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform noise filtering on a image stack along the time axis for each
pixel independently.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dset</strong> (<em>dict</em>) – filename (str) -&gt; Data (object).
A dictionary mapping tiff stack filenames to Data object.</p></li>
<li><p><strong>im_set</strong> (<em>dict</em>) – filename (str) -&gt; pre-filtering image (ndarray).
A dictionary mapping tiff filenames to images need to be filtered.</p></li>
<li><p><strong>noise_filter</strong> (<em>ndarray</em>) – Noise filtering kernel, e.g. 1D-Gaussian.</p></li>
<li><p><strong>filtername</strong> (<em>str</em>) – Name of the filter for Data.add_filtered.</p></li>
<li><p><strong>filenames</strong> (<em>list</em><em> (</em><em>str</em><em>)</em>) – Sequence of filenames for the filtering.</p></li>
<li><p><strong>return_option</strong> (<em>bool</em>) – Whether to return the results after noise filtering or not.</p></li>
<li><p><strong>return_type</strong> (<em>str</em>) – Choose the format of the returned value. Can use either ‘ndarray’ or ‘dict’</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>m_filtered</strong> (<em>ndarray</em>) – Filtered image stack in the format of a numpy.ndarray.</p></li>
<li><p><strong>m_filtered</strong> (<em>dict</em>) – Filtered image stack in the format of a dictionary.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-pysofi.finterp">
<span id="pysofi-finterp-module"></span><h2>pysofi.finterp module<a class="headerlink" href="#module-pysofi.finterp" title="Permalink to this headline">¶</a></h2>
<p>This module performs fourier interpolation on a single image
or a image stack (tiff file). Interpolated image (stack) can be
saved into a new tiff file or return as a numpy array.</p>
<p>Fourier interpolation was implemented with transformation matrix
operation, where the Fourier transformation matrix was constructed
with the original matrix size without interpolation grids, and the
inverse Fourier transformation matrix encodes the extra interpolation
position coordinates.</p>
<p>Adapted from <a class="reference external" href="https://github.com/xiyuyi/xy_fInterp_forTIFF">https://github.com/xiyuyi/xy_fInterp_forTIFF</a>.</p>
<dl class="py function">
<dt class="sig sig-object py" id="pysofi.finterp.fourier_interp_array">
<span class="sig-prename descclassname"><span class="pre">pysofi.finterp.</span></span><span class="sig-name descname"><span class="pre">fourier_interp_array</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">im</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">interp_num_lst</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.finterp.fourier_interp_array" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs fourier interpolation on an image array with a list of
interpolation factors.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pysofi.finterp.fourier_interp_tiff">
<span class="sig-prename descclassname"><span class="pre">pysofi.finterp.</span></span><span class="sig-name descname"><span class="pre">fourier_interp_tiff</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filepath</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">interp_num_lst</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">frames</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_option</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_option</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.finterp.fourier_interp_tiff" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs fourier interpolation on a tiff image (stack) with a list of
interpolation factors (the number of pixels to be interpolated between
two adjacent pixels).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filepath</strong> (<em>str</em>) – The path to the tiff file.</p></li>
<li><p><strong>filename</strong> (<em>str</em>) – The filename of the tiff file without ‘.tif’.</p></li>
<li><p><strong>interp_num_lst</strong> (<em>list</em><em> (</em><em>int</em><em>)</em>) – A list of interpolation factors.</p></li>
<li><p><strong>frames</strong> (<em>list of int</em>) – The start and end frame number.</p></li>
<li><p><strong>save_option</strong> (<em>bool</em>) – Whether to save the interpolated images into tiff files (each
interpolation factor seperately).</p></li>
<li><p><strong>return_option</strong> (<em>bool</em>) – Whether to return the interpolated image series as 3d arrays.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>interp_imstack_lst</strong> – A list of interpolated image series corresponding to the interpolation
factor list.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>list (ndarray)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pysofi.finterp.ft_matrix2d">
<span class="sig-prename descclassname"><span class="pre">pysofi.finterp.</span></span><span class="sig-name descname"><span class="pre">ft_matrix2d</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">xrange</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">yrange</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.finterp.ft_matrix2d" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate fourier transform matrix for x- and y-dimension.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pysofi.finterp.ift_matrix2d">
<span class="sig-prename descclassname"><span class="pre">pysofi.finterp.</span></span><span class="sig-name descname"><span class="pre">ift_matrix2d</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">xrange</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">yrange</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">interp_num</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.finterp.ift_matrix2d" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate inverse fourier transform matrix without center shift for a
given fold of interpolation for x- and y-dimension. Here we use 2 times
the x-dimension of a frame image for xrange and 2 times of y for yrange.
interp_num is the number of times the resolution enhanced. For instance,
when interp_num = 2, the resolution is two times the original one.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pysofi.finterp.interpolate_image">
<span class="sig-prename descclassname"><span class="pre">pysofi.finterp.</span></span><span class="sig-name descname"><span class="pre">interpolate_image</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">im</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fy</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ifx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ify</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">interp_num</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.finterp.interpolate_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs fourier interpolation to increase the resolution of the image.
The interpolated image can be further processed by SOFI for
super-resolution imaging.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>im</strong> (<em>ndarray</em>) – Input image.</p></li>
<li><p><strong>fx</strong> (<em>ndarray</em>) – Fourier transform matrix in x generated from ft_matrix2d function.</p></li>
<li><p><strong>fy</strong> (<em>ndarray</em>) – Fourier transform matrix in y generated from ft_matrix2d function.</p></li>
<li><p><strong>ifx</strong> (<em>ndarray</em>) – Inverse fourier transform matrix in x from ift_matrix2d function.</p></li>
<li><p><strong>ify</strong> (<em>ndarray</em>) – Inverse fourier transform matrix in y from ift_matrix2d function.</p></li>
<li><p><strong>interp_num</strong> (<em>int</em>) – The number of pixels to be interpolated between two adjacent pixels.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>interp_im</strong> – Interpolated image with new dimensions.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Please note here that interpolation doesn’ extend over the edgeo f the
matrix, therefore the total number of pixels in the resulting matrix is
not an integer fold of the original size of the matrix. For example, if
the original matrix size of each frame is xdim and ydim for x and y
dimensions respectively. After interpolation, the size of the resulting
matrix will be ((xdim-1)*f + 1) for x dimension, and ((ydim-1)*f + 1)
for y dimension.</p>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">mu</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">xdim</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">xdim</span><span class="p">))</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="o">*</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
<span class="n">xrange</span><span class="p">,</span> <span class="n">yrange</span><span class="p">,</span> <span class="n">interp_num</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">xdim</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ydim</span><span class="p">,</span> <span class="mi">3</span>
<span class="n">fx</span><span class="p">,</span> <span class="n">fy</span> <span class="o">=</span> <span class="n">ft_matrix2d</span><span class="p">(</span><span class="n">xrange</span><span class="p">,</span> <span class="n">yrange</span><span class="p">)</span>
<span class="n">ifx</span><span class="p">,</span> <span class="n">ify</span> <span class="o">=</span> <span class="n">ift_matrix2d</span><span class="p">(</span><span class="n">xrange</span><span class="p">,</span> <span class="n">yrange</span><span class="p">,</span> <span class="n">interp_num</span><span class="p">)</span>
<span class="n">interp_im</span> <span class="o">=</span> <span class="n">interpolate_image</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">fx</span><span class="p">,</span> <span class="n">fy</span><span class="p">,</span> <span class="n">ifx</span><span class="p">,</span> <span class="n">ify</span><span class="p">,</span> <span class="n">interp_num</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="module-pysofi.ldrc">
<span id="pysofi-ldrc-module"></span><h2>pysofi.ldrc module<a class="headerlink" href="#module-pysofi.ldrc" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="pysofi.ldrc.ldrc">
<span class="sig-prename descclassname"><span class="pre">pysofi.ldrc.</span></span><span class="sig-name descname"><span class="pre">ldrc</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mask_im</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">input_im</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">order</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">window_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[25,</span> <span class="pre">25]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.ldrc.ldrc" title="Permalink to this definition">¶</a></dt>
<dd><p>Process the image array with “local dynamic range compression” (ldrc).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mask_im</strong> (<em>ndarray</em>) – A reference image.
Usually a average/sum image or second-order SOFI image is used.</p></li>
<li><p><strong>input_im</strong> (<em>ndarray</em>) – An input image, usually a high-order moment- or cumulant-
reconstructed image.</p></li>
<li><p><strong>order</strong> (<em>int</em>) – The order of the reconstructed image.</p></li>
<li><p><strong>window_size</strong> (<em>[</em><em>int</em><em>, </em><em>int</em><em>]</em>) – The [x, y] dimension of the scanning window.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>ldrc_im</strong> – The compressed image with the same dimensions of input_im.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>High-order cumulants or moments reconstructions result-in images with a
large dynamic range of pixel intensities. This ldrc algorithm compresses
the dynamic range of these reconstructions with respect to a reference
image while retaining resolution enhancement.
The compression is performed locally in a small window that is scanned
across the image. For details of the ldrc method, see [1].</p>
<p class="rubric">References</p>
<dl class="footnote brackets">
<dt class="label" id="id6"><span class="brackets">1</span></dt>
<dd><p>Xiyu Yi, Sungho Son, Ryoko Ando, Atsushi Miyawaki, and Shimon Weiss,</p>
</dd>
</dl>
<p>“Moments reconstruction and local dynamic range compression of high order
superresolution optical fluctuation imaging,” Biomed. Opt. Express 10,
2430-2445 (2019).</p>
</dd></dl>

</section>
<section id="module-pysofi.masks">
<span id="pysofi-masks-module"></span><h2>pysofi.masks module<a class="headerlink" href="#module-pysofi.masks" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="pysofi.masks.gauss1d_mask">
<span class="sig-prename descclassname"><span class="pre">pysofi.masks.</span></span><span class="sig-name descname"><span class="pre">gauss1d_mask</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">shape</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(1,</span> <span class="pre">3)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.masks.gauss1d_mask" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate a 1D gaussian mask.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pysofi.masks.gauss2d_mask">
<span class="sig-prename descclassname"><span class="pre">pysofi.masks.</span></span><span class="sig-name descname"><span class="pre">gauss2d_mask</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">shape</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(3,</span> <span class="pre">3)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.masks.gauss2d_mask" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate a 2D gaussian mask - should give the same result as MATLAB’s
fspecial(‘gaussian’,[shape],[sigma]).</p>
</dd></dl>

</section>
<section id="module-pysofi.reconstruction">
<span id="pysofi-reconstruction-module"></span><h2>pysofi.reconstruction module<a class="headerlink" href="#module-pysofi.reconstruction" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="pysofi.reconstruction.average_image">
<span class="sig-prename descclassname"><span class="pre">pysofi.reconstruction.</span></span><span class="sig-name descname"><span class="pre">average_image</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filepath</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">frames</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.reconstruction.average_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the average image for a video file (tiff stack), either for the
whole video or for user defined frames.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filepath</strong> (<em>str</em>) – Path to the tiff file.</p></li>
<li><p><strong>filename</strong> (<em>str</em>) – Name of the tiff file.</p></li>
<li><p><strong>frames</strong> (<em>list of int</em><em>, </em><em>optional</em>) – Start and end frame number if not the whole video is used.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>mean_im</strong> – The average image.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pysofi.reconstruction.average_image_with_finterp">
<span class="sig-prename descclassname"><span class="pre">pysofi.reconstruction.</span></span><span class="sig-name descname"><span class="pre">average_image_with_finterp</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filepath</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">interp_num</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.reconstruction.average_image_with_finterp" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the average image with fourier interpolation for a video file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filepath</strong> (<em>str</em>) – Path to the tiff file.</p></li>
<li><p><strong>filename</strong> (<em>str</em>) – Name of the tiff file.</p></li>
<li><p><strong>interp_num</strong> (<em>int</em>) – Interpolation factor.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>mean_im</strong> (<em>ndarray</em>) – The average image after fourier interpolation. Interpolated</p></li>
<li><p><em>images can be further used for SOFI processing.</em></p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pysofi.reconstruction.block_ave_cumulants">
<span class="sig-prename descclassname"><span class="pre">pysofi.reconstruction.</span></span><span class="sig-name descname"><span class="pre">block_ave_cumulants</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filepath</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">highest_order</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">smooth_kernel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">251</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fbc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.04</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.reconstruction.block_ave_cumulants" title="Permalink to this definition">¶</a></dt>
<dd><p>Get average cumulant-reconstructed images of all blocks determined by
user-defined noise filtering and bleaching correction factor (fbc).</p>
<p>Within each block, the amount of signal decrease is identical. This
amount of signal decrease is characterized by the bleaching correction
factor, fbc, which is the fractional signal decrease within each block
(as compared to the total signal decrease over the whole signal plot).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filepath</strong> (<em>str</em>) – Path to the tiff file.</p></li>
<li><p><strong>filename</strong> (<em>str</em>) – Name of the tiff file.</p></li>
<li><p><strong>highest_order</strong> (<em>int</em>) – The highest order number of moment-reconstructed images.</p></li>
<li><p><strong>smooth_kernel</strong> (<em>int</em>) – The size of the median filter (‘filtering.med_smooth’) window.</p></li>
<li><p><strong>fbc</strong> (<em>float</em>) – The fraction of signal decrease within each block compared to the
total signal decrease.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>ave_k_set</strong> – order number (int) -&gt; image (ndarray)
A dictionary of avereage cumulant-reconstructed images of all blocks.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>For more information on noise filtering and bleaching corrextion, please
see appendix 3 of [1].</p>
<p class="rubric">References</p>
<dl class="footnote brackets">
<dt class="label" id="id7"><span class="brackets">1</span></dt>
<dd><ol class="upperalpha simple" start="24">
<li><p>Yi, and S. Weiss. “Cusp-artifacts in high order superresolution</p></li>
</ol>
</dd>
</dl>
<p>optical fluctuation imaging.” bioRxiv: 545574 (2019).</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pysofi.reconstruction.block_ave_moments">
<span class="sig-prename descclassname"><span class="pre">pysofi.reconstruction.</span></span><span class="sig-name descname"><span class="pre">block_ave_moments</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filepath</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">highest_order</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">smooth_kernel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">251</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fbc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.04</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.reconstruction.block_ave_moments" title="Permalink to this definition">¶</a></dt>
<dd><p>Get average moment-reconstructed images of all blocks determined by
user-defined noise filtering and bleaching correction factor (fbc).
Similar to ‘block_ave_cumulants’.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filepath</strong> (<em>str</em>) – Path to the tiff file.</p></li>
<li><p><strong>filename</strong> (<em>str</em>) – Name of the tiff file.</p></li>
<li><p><strong>highest_order</strong> (<em>int</em>) – The highest order number of moment-reconstructed images.</p></li>
<li><p><strong>smooth_kernel</strong> (<em>int</em>) – The size of the median filter (‘filtering.med_smooth’) window.</p></li>
<li><p><strong>fbc</strong> (<em>float</em>) – The fraction of signal decrease within each block compared to the
total signal decrease.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>ave_m_set</strong> – order number (int) -&gt; image (ndarray)
A dictionary of avereage moment-reconstructed images of all blocks.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pysofi.reconstruction.calc_block_moments">
<span class="sig-prename descclassname"><span class="pre">pysofi.reconstruction.</span></span><span class="sig-name descname"><span class="pre">calc_block_moments</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filepath</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">highest_order</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">frames</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.reconstruction.calc_block_moments" title="Permalink to this definition">¶</a></dt>
<dd><p>Get moment-reconstructed images for user-defined frames (block) of
a video file(tiff stack).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filepath</strong> (<em>str</em>) – Path to the tiff file.</p></li>
<li><p><strong>filename</strong> (<em>str</em>) – Name of the tiff file.</p></li>
<li><p><strong>highest_order</strong> (<em>int</em>) – The highest order number of moment-reconstructed images.</p></li>
<li><p><strong>frames</strong> (<em>list of int</em>) – Start and end frame number.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>m_set</strong> – order number (int) -&gt; image (ndarray)
A dictionary of calcualted moment-reconstructed images.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Similar to ‘calc_moments’. Here we omit previously calculated m_set
and mean_im as inputs since a block usually has much fewer number of
frames and takes shorter calculation time.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pysofi.reconstruction.calc_cumulants_from_moments">
<span class="sig-prename descclassname"><span class="pre">pysofi.reconstruction.</span></span><span class="sig-name descname"><span class="pre">calc_cumulants_from_moments</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">moment_set</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.reconstruction.calc_cumulants_from_moments" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate cumulant images from moment images using the recursive relation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>moment_set</strong> (<em>dict</em>) – order number (int) -&gt; image (ndarray)
A dictionary of calcualted moment- images.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>k_set</strong> – order number (int) -&gt; image (ndarray)
A dictionary of calcualted cumulant-reconstructed images.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pysofi.reconstruction.calc_cumulants_from_moments_with_lag">
<span class="sig-prename descclassname"><span class="pre">pysofi.reconstruction.</span></span><span class="sig-name descname"><span class="pre">calc_cumulants_from_moments_with_lag</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">m_set</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tauSeries</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.reconstruction.calc_cumulants_from_moments_with_lag" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate cumulant-reconstructed images from moment-reconstructed images
with time lags.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>m_set</strong> (<em>dict</em>) – order (int) -&gt; dict (partition (tuple) -&gt; image (ndarray))
A nested dictionary of moment-reconstructions of all partitions that
calculated from ‘calc_moments_with_lag’.</p></li>
<li><p><strong>tauSeries</strong> (<em>list of int</em>) – A list of time lags for frames contribute to moment reconstruction.
The first element is recommended to be 0, and there should be seven
elements in the list. The values should be the same as the input for
‘calc_moments_with_lag’.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>k_set</strong> – order number (int) -&gt; image (ndarray)
A dictionary of calcualted cumulant-reconstructed images with time
lags.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pysofi.reconstruction.calc_moment_im">
<span class="sig-prename descclassname"><span class="pre">pysofi.reconstruction.</span></span><span class="sig-name descname"><span class="pre">calc_moment_im</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filepath</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">order</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">frames</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mean_im</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.reconstruction.calc_moment_im" title="Permalink to this definition">¶</a></dt>
<dd><p>Get one moment-reconstructed image of a defined order for a video file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filepath</strong> (<em>str</em>) – Path to the tiff file.</p></li>
<li><p><strong>filename</strong> (<em>str</em>) – Name of the tiff file.</p></li>
<li><p><strong>order</strong> (<em>int</em>) – The order number of moment-reconstructed image.</p></li>
<li><p><strong>frames</strong> (<em>list of int</em>) – The start and end frame number.</p></li>
<li><p><strong>mean_im</strong> (<em>ndarray</em>) – Average image of the tiff stack.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>moment_im</strong> – The moments-reconstructed image.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pysofi.reconstruction.calc_moments">
<span class="sig-prename descclassname"><span class="pre">pysofi.reconstruction.</span></span><span class="sig-name descname"><span class="pre">calc_moments</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filepath</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">highest_order</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">frames</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">m_set</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mean_im</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.reconstruction.calc_moments" title="Permalink to this definition">¶</a></dt>
<dd><p>Get all moment-reconstructed images to the user-defined highest order for
a video file(tiff stack).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filepath</strong> (<em>str</em>) – Path to the tiff file.</p></li>
<li><p><strong>filename</strong> (<em>str</em>) – Name of the tiff file.</p></li>
<li><p><strong>highest_order</strong> (<em>int</em>) – The highest order number of moment-reconstructed images.</p></li>
<li><p><strong>frames</strong> (<em>list of int</em>) – The start and end frame number.</p></li>
<li><p><strong>m_set</strong> (<em>dict</em>) – order number (int) -&gt; image (ndarray)
A dictionary of previously calcualted moment-reconstructed images.</p></li>
<li><p><strong>mean_im</strong> (<em>ndarray</em>) – Average image of the tiff stack.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>m_set</strong> – order number (int) -&gt; image (ndarray)
A dictionary of calcualted moment-reconstructed images.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pysofi.reconstruction.calc_moments_with_lag">
<span class="sig-prename descclassname"><span class="pre">pysofi.reconstruction.</span></span><span class="sig-name descname"><span class="pre">calc_moments_with_lag</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filepath</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tauSeries</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">frames</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.reconstruction.calc_moments_with_lag" title="Permalink to this definition">¶</a></dt>
<dd><p>Get moment-reconnstructed images with defined time lags.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filepath</strong> (<em>str</em>) – Path to the tiff file.</p></li>
<li><p><strong>filename</strong> (<em>str</em>) – Name of the tiff file.</p></li>
<li><p><strong>tauSeries</strong> (<em>list of int</em>) – A list of time lags for frames contribute to moment reconstruction.
The first element is recommended to be 0, and there should seven
elements in the list.</p></li>
<li><p><strong>frames</strong> (<em>list of int</em>) – The start and end frame number.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>m_set</strong> – order (int) -&gt; dict (partition (tuple) -&gt; image (ndarray))
A nested dictionary of moment-reconstructions of all partitions.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pysofi.reconstruction.calc_total_signal">
<span class="sig-prename descclassname"><span class="pre">pysofi.reconstruction.</span></span><span class="sig-name descname"><span class="pre">calc_total_signal</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filepath</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.reconstruction.calc_total_signal" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the total signal intensity of each frame for the whole
video (tiff stack).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filepath</strong> (<em>str</em>) – Path to the tiff file.</p></li>
<li><p><strong>filename</strong> (<em>str</em>) – Name of the tiff file.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>total_signal</strong> – Signal intensity of each frame ordered by the frame number.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>1darray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pysofi.reconstruction.calc_xc_im">
<span class="sig-prename descclassname"><span class="pre">pysofi.reconstruction.</span></span><span class="sig-name descname"><span class="pre">calc_xc_im</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filepath</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ri_range</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">frames</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.reconstruction.calc_xc_im" title="Permalink to this definition">¶</a></dt>
<dd><p>Get cross-cumulant image with different pixel combinations.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filepath</strong> (<em>str</em>) – Path to the tiff file.</p></li>
<li><p><strong>filename</strong> (<em>str</em>) – Name of the tiff file.</p></li>
<li><p><strong>ri_range</strong> (<em>int</em>) – Maximium distance (# pixels) between the original the selected pixel.</p></li>
<li><p><strong>frames</strong> (<em>list of int</em>) – The start and end frame number.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>xc</strong> – pixel (tuple) -&gt; image (ndarray)
A dictionary of reconstructed images with pixel index as keys.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pysofi.reconstruction.correct_bleaching">
<span class="sig-prename descclassname"><span class="pre">pysofi.reconstruction.</span></span><span class="sig-name descname"><span class="pre">correct_bleaching</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filepath</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fbc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.04</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">smooth_kernel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">251</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_option</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_option</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.reconstruction.correct_bleaching" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs bleaching correction on a tiff image (stack).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fbc</strong> (<em>float</em>) – The fraction of signal decrease within each block compared
to the total signal decrease. Only used when bleach correction
is True.</p></li>
<li><p><strong>smooth_kernel</strong> (<em>int</em>) – The size of the median filter window.</p></li>
<li><p><strong>save_option</strong> (<em>bool</em>) – Whether to save the corrected images into tiff files.</p></li>
<li><p><strong>return_option</strong> (<em>bool</em>) – Whether to return the corrected image series as a 3d array.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>bc_im</strong> – All bleaching-corrected imagee in a 3d array.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pysofi.reconstruction.cumulants_all_blocks">
<span class="sig-prename descclassname"><span class="pre">pysofi.reconstruction.</span></span><span class="sig-name descname"><span class="pre">cumulants_all_blocks</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">m_set_all_blocks</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.reconstruction.cumulants_all_blocks" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate cumulant-reconstructed images from moment-reconstructed images
of each block. Similar to ‘calc_cumulants_from_moments’.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pysofi.reconstruction.cut_frames">
<span class="sig-prename descclassname"><span class="pre">pysofi.reconstruction.</span></span><span class="sig-name descname"><span class="pre">cut_frames</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">signal_level</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fbc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.04</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.reconstruction.cut_frames" title="Permalink to this definition">¶</a></dt>
<dd><p>Find the list of frame number to cut the whole signal plot into seperate
blocks based on the change of total signal intensity.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>signal_level</strong> (<em>1darray</em>) – Signal change over time (can be derived from ‘calc_total_signal’).</p></li>
<li><p><strong>fbc</strong> (<em>float</em>) – The fraction of signal decrease within each block compared to the
total signal decrease.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>bounds</strong> (<em>list of int</em>) – Signal intensities on the boundary of each block.</p></li>
<li><p><strong>frame_lst</strong> (<em>list of int</em>) – Frame number where to cut the whole signal plot into blocks.</p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The number of blocks is the inverse of the bleaching correction factor,
fbc. For instance, if fbc=0.04, it means that in each block, the
decrease in signal intensity is 4% if the total decrease, and the whole
plot / video is cut into 25 blocks. For some data, it is possible that
the maximun signal intensity does not appear at the beginning of the
signal plot. Here, we consider all frames before the maximum in the
same block as the maximum frame / intensity since usually the number
of frames is not too large. The user can add in extra blocks if the
initial intensity is much smaller than the maximum.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pysofi.reconstruction.min_image">
<span class="sig-prename descclassname"><span class="pre">pysofi.reconstruction.</span></span><span class="sig-name descname"><span class="pre">min_image</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filepath</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">frames</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.reconstruction.min_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the minimum image for a video file (tiff stack), either for the
whole video or for user defined frames.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filepath</strong> (<em>str</em>) – Path to the tiff file.</p></li>
<li><p><strong>filename</strong> (<em>str</em>) – Name of the tiff file.</p></li>
<li><p><strong>frames</strong> (<em>list of int</em><em>, </em><em>optional</em>) – Start and end frame number if not the whole video is used.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>min_im</strong> – The minimum image.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pysofi.reconstruction.moment_im_with_finterp">
<span class="sig-prename descclassname"><span class="pre">pysofi.reconstruction.</span></span><span class="sig-name descname"><span class="pre">moment_im_with_finterp</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filepath</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">order</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">interp_num</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">frames</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mean_im</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.reconstruction.moment_im_with_finterp" title="Permalink to this definition">¶</a></dt>
<dd><p>Get one moment-reconstructed image of a defined order for a video file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filepath</strong> (<em>str</em>) – Path to the tiff file.</p></li>
<li><p><strong>filename</strong> (<em>str</em>) – Name of the tiff file.</p></li>
<li><p><strong>order</strong> (<em>int</em>) – The order number of moment-reconstructed image.</p></li>
<li><p><strong>interp_num</strong> (<em>int</em>) – The interpolation factor.</p></li>
<li><p><strong>mvlength</strong> (<em>int</em>) – The length of video for the reconstruction.</p></li>
<li><p><strong>mean_im</strong> (<em>ndarray</em>) – Average image of the tiff stack.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>moment_im</strong> – The moments-reconstructed image.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pysofi.reconstruction.moments_all_blocks">
<span class="sig-prename descclassname"><span class="pre">pysofi.reconstruction.</span></span><span class="sig-name descname"><span class="pre">moments_all_blocks</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filepath</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">highest_order</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">smooth_kernel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">251</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fbc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.04</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.reconstruction.moments_all_blocks" title="Permalink to this definition">¶</a></dt>
<dd><p>Get moment-reconstructed images for seperate blocks with user-defined
noise filtering and bleaching correction factor (fbc).</p>
<p>Within each block, the amount of signal decrease is identical. This
amount of signal decrease is characterized by the bleaching correction
factor, fbc, which is the fractional signal decrease within each block
(as compared to the total signal decrease over the whole signal plot).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filepath</strong> (<em>str</em>) – Path to the tiff file.</p></li>
<li><p><strong>filename</strong> (<em>str</em>) – Name of the tiff file.</p></li>
<li><p><strong>highest_order</strong> (<em>int</em>) – The highest order number of moment-reconstructed images.</p></li>
<li><p><strong>smooth_kernel</strong> (<em>int</em>) – The size of the median filter (‘filtering.med_smooth’) window.</p></li>
<li><p><strong>fbc</strong> (<em>float</em>) – The fraction of signal decrease within each block compared to the
total signal decrease.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>m_set_all_blocks</strong> – block_number (int) -&gt; {order number (int) -&gt; image (ndarray)}
A dictionary of moment-reconstructed images of each block.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Similar to ‘calc_moments’. Here we omit previously calculated m_set
and mean_im as inputs since a block usually has much fewer number of
frames and takes shorter calculation time.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pysofi.reconstruction.sorted_k_partitions">
<span class="sig-prename descclassname"><span class="pre">pysofi.reconstruction.</span></span><span class="sig-name descname"><span class="pre">sorted_k_partitions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">seq</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">k</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pysofi.reconstruction.sorted_k_partitions" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a list of all unique k-partitions of <cite>seq</cite>.
Each partition is a list of parts, and each part is a tuple.</p>
</dd></dl>

</section>
<section id="pysofi-visualization-module">
<h2>pysofi.visualization module<a class="headerlink" href="#pysofi-visualization-module" title="Permalink to this headline">¶</a></h2>
</section>
<section id="module-pysofi">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-pysofi" title="Permalink to this headline">¶</a></h2>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="index.html">Table of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="start.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="demos.html">Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="manual.html">Reference manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/functions.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">pysofi 0.1.1 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">pysofi package</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Yuting Miao.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.2.0.
    </div>
  </body>
</html>